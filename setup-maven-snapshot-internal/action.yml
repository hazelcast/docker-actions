name: Set up Maven for `snapshot-internal` repository with authentication
inputs:
  aws-role-to-assume:
    description: 'AWS Role to assume for accessing secrets'
    required: true
  maven-settings-path:
    description: 'Override default Maven settings.xml location e.g. /usr/share/maven/conf/settings.xml'
    required: false
runs:
  using: "composite"
  steps:
      # Should be a relative local path, but doesn't resolve when called from another repo
    - uses: hazelcast/docker-actions/get-jfrog-credentials@master
      id: jfrog
      with:
        aws-role-to-assume: ${{ inputs.aws-role-to-assume }}
        jfrog-oidc-provider-name: ${{ github.repository_owner }}-snapshot-internal

    - uses: s4u/maven-settings-action@894661b3ddae382f1ae8edbeab60987e08cf0788 # v4.0.0
      with:
        path: ${{ inputs.maven-settings-path }}
        servers: |
          [{
              "id": "snapshot-internal",
              "username": "${{ steps.jfrog.outputs.user }}",
              "password": "${{ steps.jfrog.outputs.token }}"
          }]
